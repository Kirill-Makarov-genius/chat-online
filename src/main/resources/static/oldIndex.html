<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Chat with WebSocket</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script>


</head>
<body>
    <h2>WebSocket Chat</h2>
    <input type="text" id="message" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
    <ul id="messages"></ul>

    <script>

        var socket = new SockJS("http://localhost:8080/chat");
        var stompClint = Stomp.over(socket);

        stompClint.connect({}, function (){
            stompClint.subscribe("/topic/messages", function(message){
                var msg = JSON.parse(message.body);
                var li = document.createElement("li");
                li.appendChild(document.createTextNode(msg.sender + ": " + msg.content));
                document.getElementById("messages").appendChild(li);
            });
        });

        function sendMessage(){
            console.log("work")
            var content = document.getElementById("message").value;
            var msg = { sender : "User", content: content};
            stompClint.send("/app/sendMessage", {}, JSON.stringify(msg));
            document.getElementById("message").value = "";
        }

    </script>
</body>
</html>