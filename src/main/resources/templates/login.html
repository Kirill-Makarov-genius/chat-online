<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 1. Include Head Fragment + Auth CSS -->
<head th:replace="~{fragments/head :: common-head('Connect | Chat Online', '/css/pages/auth.css')}"></head>

<body>

<div class="auth-card glass-card">

    <!-- Header / Logo -->
    <div class="text-center mb-4">
        <i class="bi bi-chat-square-quote-fill brand-icon mb-2 d-block"></i>
        <h2 class="fw-bold text-white mb-1">Welcome Back</h2>
        <p class="text-secondary small">Sign in to continue chatting</p>
    </div>

    <!-- Tab Switcher -->
    <ul class="nav nav-tabs nav-fill" id="authTabs" role="tablist">

        <!-- LOGIN TAB BUTTON -->
        <!-- LOGIC: Active if DTO is null OR if 'registered' param is present -->
        <li class="nav-item" role="presentation">
            <button class="nav-link w-100"
                    th:classappend="${(registrationFormDto == null || param.registered != null) ? 'active' : ''}"
                    id="login-tab" data-bs-toggle="tab" data-bs-target="#login-pane" type="button">
                Sign In
            </button>
        </li>

        <!-- REGISTER TAB BUTTON -->
        <!-- LOGIC: Active only if DTO is NOT null AND 'registered' is NOT present -->
        <li class="nav-item" role="presentation">
            <button class="nav-link w-100"
                    th:classappend="${(registrationFormDto != null && param.registered == null) ? 'active' : ''}"
                    id="register-tab" data-bs-toggle="tab" data-bs-target="#register-pane" type="button">
                Create Account
            </button>
        </li>
    </ul>

    <div class="tab-content" id="authTabsContent">

        <!-- ================= LOGIN PANE ================= -->
        <!-- LOGIC: Show if DTO is null OR if 'registered' param is present -->
        <div class="tab-pane fade"
             th:classappend="${(registrationFormDto == null || param.registered != null) ? 'show active' : ''}"
             id="login-pane" role="tabpanel">

            <form th:action="@{/login}" method="post">

                <!-- SUCCESS ALERT (Appears when ?registered is in URL) -->
                <div th:if="${param.registered}" class="alert alert-success bg-success bg-opacity-10 border-success border-opacity-25 text-success small py-3 mb-4 d-flex align-items-center rounded-3">
                    <i class="bi bi-check-circle-fill me-3 fs-5"></i>
                    <div>
                        <strong>Success!</strong><br>
                        Account created. Please log in.
                    </div>
                </div>

                <!-- ERROR ALERT (Login failed) -->
                <div th:if="${param.error}" class="alert alert-danger bg-danger bg-opacity-10 border-danger border-opacity-25 text-danger small py-2 mb-4 d-flex align-items-center rounded-3">
                    <i class="bi bi-exclamation-circle-fill me-2"></i> Incorrect username or password
                </div>

                <!-- LOGOUT ALERT -->
                <div th:if="${param.logout}" class="alert alert-info bg-info bg-opacity-10 border-info border-opacity-25 text-info small py-2 mb-4 rounded-3">
                    <i class="bi bi-info-circle-fill me-2"></i> Logged out successfully
                </div>

                <div class="mb-3">
                    <input type="text" name="username" class="form-control form-control-dark" placeholder="Username" required autofocus>
                </div>

                <div class="mb-4">
                    <input type="password" name="password" class="form-control form-control-dark" placeholder="Password" required>
                </div>

                <button type="submit" class="btn btn-accent w-100 py-3 mb-3">
                    Enter Chat <i class="bi bi-arrow-right-short fs-5 align-middle"></i>
                </button>
            </form>
        </div>

        <!-- ================= REGISTER PANE ================= -->
        <!-- LOGIC: Show only if DTO is NOT null AND 'registered' is NOT present -->
        <div class="tab-pane fade"
             th:classappend="${(registrationFormDto != null && param.registered == null) ? 'show active' : ''}"
             id="register-pane" role="tabpanel">

            <form th:action="@{/register}" method="post" th:object="${registrationFormDto}">

                <div class="mb-3">
                    <input type="text" th:field="*{username}" class="form-control form-control-dark" placeholder="Choose Username">
                    <span class="error-text" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></span>
                </div>

                <div class="mb-3">
                    <input type="text" th:field="*{nickname}" class="form-control form-control-dark" placeholder="Display Name (Nickname)">
                    <span class="error-text" th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}"></span>
                </div>

                <div class="mb-4">
                    <input type="password" th:field="*{password}" class="form-control form-control-dark" placeholder="Create Password">
                    <span class="error-text" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></span>
                </div>

                <button type="submit" class="btn btn-accent w-100 py-3" style="filter: hue-rotate(90deg);">
                    Join Community
                </button>
            </form>
        </div>
    </div>

    <!-- Footer text -->
    <div class="text-center mt-4">
        <p class="text-muted small mb-0 opacity-50">&copy; 2026 Chat Online Inc.</p>
    </div>

</div>


</body>
</html>