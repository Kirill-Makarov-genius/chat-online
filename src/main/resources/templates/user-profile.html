<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 1. Include Head Fragment -->
<head th:replace="~{fragments/head :: common-head(${user.nickname} + ' - Profile', '/css/pages/profile.css')}"></head>

<body>

<!-- Wrapper for scrolling -->
<div class="page-scrollable">
    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">

                <!-- BACK BUTTON -->
                <div class="mb-3">
                    <a href="/chats" class="back-link">
                        <i class="bi bi-arrow-left"></i> Back to Chats
                    </a>
                </div>

                <!-- PROFILE CARD -->
                <div class="glass-card p-0">
                    <!-- Colorful Header Banner -->
                    <div class="profile-header"></div>

                    <div class="p-4 text-center">

                        <!-- PROFILE PICTURE -->
                        <div class="profile-img-container mb-3">
                            <img th:src="${user.getProfilePictureUrl()}"
                                 class="rounded-circle profile-avatar"
                                 alt="User Avatar">
                        </div>

                        <!-- NICKNAME & USERNAME -->
                        <h2 class="fw-bold text-white mb-0" th:text="${user.nickname}">Nickname</h2>
                        <p class="text-accent small">@<span th:text="${user.username}">username</span></p>

                        <!-- STATUS -->
                        <div th:if="${user.status != null and !user.status.isEmpty()}" class="mb-4">
                            <span class="badge badge-status rounded-pill px-3 py-2">
                                <i class="bi bi-emoji-smile me-1 text-warning"></i>
                                <span th:text="${user.status}">Status</span>
                            </span>
                        </div>

                        <!-- DESCRIPTION / BIO -->
                        <div class="text-start px-2 px-md-4">
                            <h6 class="text-uppercase text-muted small fw-bold mb-2" style="letter-spacing: 1px;">About</h6>
                            <p class="text-secondary" th:text="${user.description ?: 'No description provided.'}">
                                User description...
                            </p>
                        </div>

                        <hr class="border-glass my-4">

                        <!-- ACTION BUTTONS -->
                        <div class="d-grid gap-2">

                            <!-- CASE A: Viewing My Own Profile -->
                            <a th:if="${isOwnProfile}" href="/settings" class="btn btn-outline-info rounded-pill py-2">
                                <i class="bi bi-pencil-square me-2"></i> Edit Profile
                            </a>

                            <!-- CASE B: Viewing Someone Else -->
                            <form th:unless="${isOwnProfile}" th:action="@{/chats/open}" method="post">
                                <input type="hidden" name="targetUsername" th:value="${user.username}">
                                <button type="submit" class="btn btn-accent w-100 py-2">
                                    <i class="bi bi-chat-dots-fill me-2"></i> Send Message
                                </button>
                            </form>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<div th:replace="~{fragments/notifications :: global-notifications}"></div>

</body>
</html>